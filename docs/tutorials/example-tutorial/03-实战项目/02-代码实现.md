---
title: 3.2 代码实现
date: 2025-01-01
categories:
  - 示例教程
tags:
  - 代码实现
  - 实战
---

# 3.2 代码实现

## 后端实现

### 1. 初始化项目

```bash
# 创建项目目录
mkdir todo-backend
cd todo-backend

# 初始化 npm 项目
npm init -y

# 安装依赖
npm install express sequelize sqlite3
npm install -D nodemon
```

### 2. 数据库模型

```javascript
// models/Task.js
const { DataTypes } = require('sequelize');
const sequelize = require('../config/database');

const Task = sequelize.define('Task', {
    id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true
    },
    title: {
        type: DataTypes.STRING,
        allowNull: false
    },
    description: {
        type: DataTypes.TEXT,
        allowNull: true
    },
    status: {
        type: DataTypes.STRING,
        defaultValue: 'pending'
    }
}, {
    tableName: 'tasks',
    timestamps: true
});

module.exports = Task;
```

### 3. API 路由

```javascript
// routes/tasks.js
const express = require('express');
const router = express.Router();
const Task = require('../models/Task');

// 获取所有任务
router.get('/', async (req, res) => {
    try {
        const tasks = await Task.findAll();
        res.json({ tasks });
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

// 创建任务
router.post('/', async (req, res) => {
    try {
        const { title, description } = req.body;
        const task = await Task.create({ title, description });
        res.status(201).json({ task });
    } catch (error) {
        res.status(400).json({ error: error.message });
    }
});

// 更新任务
router.put('/:id', async (req, res) => {
    try {
        const { id } = req.params;
        const { title, description, status } = req.body;
        const task = await Task.findByPk(id);
        
        if (!task) {
            return res.status(404).json({ error: 'Task not found' });
        }
        
        await task.update({ title, description, status });
        res.json({ task });
    } catch (error) {
        res.status(400).json({ error: error.message });
    }
});

// 删除任务
router.delete('/:id', async (req, res) => {
    try {
        const { id } = req.params;
        const task = await Task.findByPk(id);
        
        if (!task) {
            return res.status(404).json({ error: 'Task not found' });
        }
        
        await task.destroy();
        res.json({ success: true });
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

module.exports = router;
```

## 前端实现

### 1. 组件结构

```vue
<!-- components/TaskList.vue -->
<template>
  <div class="task-list">
    <div v-for="task in tasks" :key="task.id" class="task-item">
      <h3>{{ task.title }}</h3>
      <p>{{ task.description }}</p>
      <button @click="toggleStatus(task)">
        {{ task.status === 'completed' ? '未完成' : '完成' }}
      </button>
      <button @click="deleteTask(task.id)">删除</button>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { fetchTasks, updateTask, deleteTask as deleteTaskAPI } from '../api/tasks';

const tasks = ref([]);

onMounted(async () => {
  tasks.value = await fetchTasks();
});

const toggleStatus = async (task) => {
  const newStatus = task.status === 'completed' ? 'pending' : 'completed';
  await updateTask(task.id, { status: newStatus });
  task.status = newStatus;
};

const deleteTask = async (id) => {
  await deleteTaskAPI(id);
  tasks.value = tasks.value.filter(t => t.id !== id);
};
</script>
```

### 2. API 调用

```javascript
// api/tasks.js
const API_BASE = 'http://localhost:3000/api';

export async function fetchTasks() {
    const response = await fetch(`${API_BASE}/tasks`);
    const data = await response.json();
    return data.tasks;
}

export async function createTask(task) {
    const response = await fetch(`${API_BASE}/tasks`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(task)
    });
    return await response.json();
}

export async function updateTask(id, updates) {
    const response = await fetch(`${API_BASE}/tasks/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updates)
    });
    return await response.json();
}

export async function deleteTask(id) {
    await fetch(`${API_BASE}/tasks/${id}`, {
        method: 'DELETE'
    });
}
```

## 运行项目

### 启动后端

```bash
cd todo-backend
npm run dev
```

### 启动前端

```bash
cd todo-frontend
npm run dev
```

## 下一步

代码实现完成后，让我们进行 [测试部署](03-测试部署.md)。

---

**提示**：这是示例文章，展示了如何编写代码实现教程。

